<% include header.ejs %>

<h2 style="margin-top: 35px;
margin-bottom: -5px;">Current Patch Statistics</h2>
<div class="container-fluid">
<div class="row" id="stats"  ng-controller="data">
<div class="search-sorter">
  <input class="matchupSearch" type="text" ng-model="search.title" ng-model-options="{debounce: 40}" style="margin-left:-22px" placeholder="Filter By Name" />
</div>

<table class="table table-striped" id="table-1" style="table-layout: auto;">
  <thead id="original-header">
    <tr ng-class="{'down':determineOrder('down'),'up':determineOrder('up')}">
      <td ng-class="{'selected-column':determineSelected('title')}" style="width:10%" ng-click="changeSelection('title')"><span>Champion</span></td>
      <td ng-class="{'selected-column':determineSelected('role')}" ng-click="changeSelection('role')"><span>Role</span></td>
      <td ng-class="{'selected-column':determineSelected('winPercent')}" ng-click="changeSelection('winPercent')"><span>Win Percent</span></td>
       <td  ng-class="{'selected-column':determineSelected('playPercent')}" ng-click="changeSelection('playPercent')"><span>Play Percent</span></td>
        <td  ng-class="{'selected-column':determineSelected('banRate')}" ng-click="changeSelection('banRate')"><span>Ban Rate</span></td>
        <td  ng-class="{'selected-column':determineSelected('kills')}" style="width: 4%;"ng-click="changeSelection('kills')"><span>Kills</span></td>
         <td  ng-class="{'selected-column':determineSelected('deaths')}" style="width: 5%;" ng-click="changeSelection('deaths')"><span>Deaths</span></td>
         <td  ng-class="{'selected-column':determineSelected('assists')}" style="width: 5%;" ng-click="changeSelection('assists')"><span>Assists</span></td>
         <td  ng-class="{'selected-column':determineSelected('largestKillingSpree')}" ng-click="changeSelection('largestKillingSpree')"><span>Largest Killing Spree</span></td>
         <td  ng-class="{'selected-column':determineSelected('totalDamageDealtToChampions')}" ng-click="changeSelection('totalDamageDealtToChampions')"><span>Damage Dealt</span></td>
         <td  ng-class="{'selected-column':determineSelected('totalDamageTaken')}" ng-click="changeSelection('totalDamageTaken')"><span>Damage Taken</span></td>
         <td  ng-class="{'selected-column':determineSelected('totalHeal')}" ng-click="changeSelection('totalHeal')"><span>Total Healing</span></td>
         
         <td  ng-class="{'selected-column':determineSelected('minionsKilled')}" ng-click="changeSelection('minionsKilled')"><span>Minions Killed</span></td>
         <td  ng-class="{'selected-column':determineSelected('neutralMinionsKilledTeamJungle')}" ng-click="changeSelection('neutralMinionsKilledTeamJungle')"><span>Team Jungle CS</span></td>
         <td  ng-class="{'selected-column':determineSelected('neutralMinionsKilledEnemyJungle')}" ng-click="changeSelection('neutralMinionsKilledEnemyJungle')"><span>Enemy Jungle CS</span></td>
         <td  ng-class="{'selected-column':determineSelected('goldEarned')}" ng-click="changeSelection('goldEarned')"><span>Gold Earned</span></td>
         <td  ng-class="{'selected-column':determineSelected('overallPosition')}" ng-click="changeSelection('overallPosition')"><span>Role Position</span></td>
         <td  ng-class="{'selected-column':determineSelected('overallPositionChange')}" ng-click="changeSelection('overallPositionChange')"><span>Position Change</span></td>
    </tr>
  </thead>
  <thead id="header-fixed">
    <tr ng-class="{'down':determineOrder('down'),'up':determineOrder('up')}">
      <td ng-class="{'selected-column':determineSelected('title')}"ng-click="changeSelection('title')"><span>Champion</span></td>
      <td ng-class="{'selected-column':determineSelected('role')}" ng-click="changeSelection('role')"><span>Role</span></td>
      <td ng-class="{'selected-column':determineSelected('winPercent')}" ng-click="changeSelection('winPercent')"><span>Win Percent</span></td>
       <td  ng-class="{'selected-column':determineSelected('playPercent')}" ng-click="changeSelection('playPercent')"><span>Play Percent</span></td>
        <td  ng-class="{'selected-column':determineSelected('banRate')}" ng-click="changeSelection('banRate')"><span>Ban Rate</span></td>
        <td  ng-class="{'selected-column':determineSelected('kills')}"ng-click="changeSelection('kills')"><span>Kills</span></td>
         <td  ng-class="{'selected-column':determineSelected('deaths')}"ng-click="changeSelection('deaths')"><span>Deaths</span></td>
         <td  ng-class="{'selected-column':determineSelected('assists')}" style="width: 5%;" ng-click="changeSelection('assists')"><span>Assists</span></td>
         <td  ng-class="{'selected-column':determineSelected('largestKillingSpree')}" ng-click="changeSelection('largestKillingSpree')"><span>Largest Killing Spree</span></td>
         <td  ng-class="{'selected-column':determineSelected('totalDamageDealtToChampions')}" ng-click="changeSelection('totalDamageDealtToChampions')"><span>Damage Dealt</span></td>
         <td  ng-class="{'selected-column':determineSelected('totalDamageTaken')}" ng-click="changeSelection('totalDamageTaken')"><span>Damage Taken</span></td>
         <td  ng-class="{'selected-column':determineSelected('totalHeal')}" ng-click="changeSelection('totalHeal')"><span>Total Healing</span></td>
         
         <td  ng-class="{'selected-column':determineSelected('minionsKilled')}" ng-click="changeSelection('minionsKilled')"><span>Minions Killed</span></td>
         <td  ng-class="{'selected-column':determineSelected('neutralMinionsKilledTeamJungle')}" ng-click="changeSelection('neutralMinionsKilledTeamJungle')"><span>Team Jungle CS</span></td>
         <td  ng-class="{'selected-column':determineSelected('neutralMinionsKilledEnemyJungle')}" ng-click="changeSelection('neutralMinionsKilledEnemyJungle')"><span>Enemy Jungle CS</span></td>
         <td  ng-class="{'selected-column':determineSelected('goldEarned')}" ng-click="changeSelection('goldEarned')"><span>Gold Earned</span></td>
         <td  ng-class="{'selected-column':determineSelected('overallPosition')}" ng-click="changeSelection('overallPosition')"><span>Role Position</span></td>
         <td  ng-class="{'selected-column':determineSelected('overallPositionChange')}" ng-click="changeSelection('overallPositionChange')"><span>Position Change</span></td>
    </tr>
  </thead>
 
  <tbody ng-cloak>
     <tr ng-repeat="champion in championData | startsWith:search.title | orderBy:[order+sortExpression.sortBy,order+sortExpression.lastSortBy]">
        <td ng-class="{'selected-column':determineSelected('title')}">
        <a href="/champion/{{champion.key}}/{{champion.role}}">
          <div class="matchup-champion {{champion.key}}"></div>
          <span class="stat-champ-title">{{champion.title}}</span>
        </a>
        </td>
        <td class="stats-role-title" ng-class="{'selected-column':determineSelected('role')}" >{{champion.role}}</td>
        <td ng-class="{'selected-column':determineSelected('winPercent')}">
        <span ng-class="{'top-half': (champion.general.winPercent >= 50), 'bottom-half': (champion.general.winPercent < 50)}">{{champion.general.winPercent}}%</span>
        </td>
         <td  ng-class="{'selected-column':determineSelected('playPercent')}">{{champion.general.playPercent}}%</td>
         <td  ng-class="{'selected-column':determineSelected('banRate')}">{{champion.general.banRate}}%</td>
          <td  ng-class="{'selected-column':determineSelected('kills')}">{{champion.general.kills}}</td>
           <td  ng-class="{'selected-column':determineSelected('deaths')}">{{champion.general.deaths}}</td>
           <td  ng-class="{'selected-column':determineSelected('assists')}">{{champion.general.assists}}</td>
          <td ng-class="{'selected-column':determineSelected('largestKillingSpree')}" >{{champion.general.largestKillingSpree}}</td>
           <td ng-class="{'selected-column':determineSelected('totalDamageDealtToChampions')}">{{champion.general.totalDamageDealtToChampions}}</td>
           <td ng-class="{'selected-column':determineSelected('totalDamageTaken')}">{{champion.general.totalDamageTaken}}</td>
           <td  ng-class="{'selected-column':determineSelected('totalHeal')}">{{champion.general.totalHeal}}</td>

           <td  ng-class="{'selected-column':determineSelected('minionsKilled')}">{{champion.general.minionsKilled}}</td>
           <td ng-class="{'selected-column':determineSelected('neutralMinionsKilledTeamJungle')}">{{champion.general.neutralMinionsKilledTeamJungle}}</td>
           <td ng-class="{'selected-column':determineSelected('neutralMinionsKilledEnemyJungle')}">{{champion.general.neutralMinionsKilledEnemyJungle}}</td>
           <td ng-class="{'selected-column':determineSelected('goldEarned')}">{{champion.general.goldEarned}}</td>
           <td ng-class="{'selected-column':determineSelected('overallPosition')}">{{champion.general.overallPosition}}</td>
           <td ng-class="{'selected-column':determineSelected('overallPositionChange')}"><span class="glyphicon" ng-class="{'glyphicon-arrow-up': (champion.general.overallPositionChange > 0), 'glyphicon-arrow-down': (champion.general.overallPositionChange < 0), 'same-position': (champion.general.overallPositionChange === 0)}">{{Math.abs(champion.general.overallPositionChange)}}</span></td>
  </tbody>
</table>
</div>
</div>

<% include scripts.ejs %>



<script>
matchupData.stats = <%- JSON.stringify(data) %>;
</script>
<script src="/js/statisticsPage.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script>
(function($){
  var $fixedHeader = $("#header-fixed")
  var $table = $("#table-1")
  var $fixedHeaderTd = $("#header-fixed td");
  var $originalHeaderTd = $("#original-header td");

  function fixWidths(){
     clearTimeout(timeOut);
     var timeOut = setTimeout(function(){
        $fixedHeader.width($table.width());
       for(var t=0;t<$fixedHeaderTd.length;t++){
        console.log($originalHeaderTd.eq(0).width());
        $fixedHeaderTd.eq(t).width($originalHeaderTd.eq(t).width());
       }
    },200);
  }

  fixWidths();

  $(window).resize(fixWidths);

  $fixedHeaderTd.add($originalHeaderTd).on('click', fixWidths);

  $(window).bind("scroll", function() {
      var offset = $(this).scrollTop();
      var tableOffset = $table.offset().top;

      if (offset >= tableOffset && $fixedHeader.is(":hidden")) {
          $fixedHeader.show();
      }
      else if (offset < tableOffset) {
          $fixedHeader.hide();
      }
  });
})(jQuery);

</script> 

<% include footer.ejs %>
